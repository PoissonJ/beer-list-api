sudo: required
language: python
python:
- '2.7'
addons:
  ssh_known_hosts: 45.55.181.86
services: docker
env:
  global:
    - DOCKER_CACHE_FILE=/home/travis/docker/cache.tar.gz
before_install:
- if [ -f ${DOCKER_CACHE_FILE} ]; then gunzip -c ${DOCKER_CACHE_FILE} | docker load; fi
- openssl aes-256-cbc -K $encrypted_8fab0ebf337a_key -iv $encrypted_8fab0ebf337a_iv
  -in travis_rsa.enc -out travis_rsa -d
- chmod 600 travis_rsa
- mv travis_rsa ~/.ssh/id_rsa
script:
- bash test.sh
- if [[ ${TRAVIS_BRANCH} == "master" ]] && [[ ${TRAVIS_PULL_REQUEST} == "false" ]]; then mkdir -p $(dirname ${DOCKER_CACHE_FILE}) ; docker save $(docker history -q ${DOCKER_REPOSITORY}:${TRAVIS_COMMIT} | grep -v '<missing>') | gzip > ${DOCKER_CACHE_FILE}; fi
after_success:
- bash deploy.sh
